# 字母下落射击游戏 - 项目开发介绍文档

## 1. 项目简介
本项目是一款基于 Windows API (Win32) 开发的轻量级桌面打字练习游戏。玩家通过键盘输入屏幕上随机下落的字母来进行消除，旨在提升打字速度和反应能力。游戏采用纯 C++ 编写，不依赖第三方图形库，展示了 Windows 消息驱动编程的基本原理。

## 2. 功能特性

### 2.1 核心玩法
*   **随机生成**：字母从屏幕顶部随机位置生成，颜色随机变化。
*   **键盘交互**：玩家按下对应字母键（不区分大小写）即可消除屏幕上的字母。
*   **动态难度**：随着得分增加，字母下落速度逐渐加快，游戏难度平滑上升。

### 2.2 游戏系统 (2.0版本更新)
*   **连击系统 (Combo)**：
    *   连续无失误击中字母可积累连击数。
    *   **得分倍率**：基础分 1 分，连击越高得分越多（公式：`1 + Combo/5`）。
    *   **连击中断**：字母落地或按错键，连击数立即归零。
*   **生命回复机制**：
    *   初始允许最大失败次数为 10 次。
    *   **奖励机制**：每达成 10 连击（如 10, 20...），自动回复 1 点生命值，鼓励玩家通过连续正确输入挽回劣势。
*   **数据持久化**：
    *   **最高分记录**：游戏会自动保存历史最高分到本地文件，每次启动自动加载。
*   **音效反馈**：
    *   **击中**：播放清脆的高频提示音。
    *   **连击奖励**：每10连击播放特殊的奖励音效。
    *   **失误/落地**：播放低沉的低频提示音。

### 2.3 辅助功能
*   **暂停/继续**：游戏过程中按 `ESC` 键可随时暂停游戏，再次按下继续。
*   **菜单控制**：提供标准的 Windows 菜单栏，支持开始游戏、关于信息和退出功能。
*   **状态显示**：实时显示当前得分、最高记录、剩余生命值、当前等级及连击状态。

## 3. 技术实现细节

### 3.1 开发环境
*   **编程语言**：C++
*   **开发框架**：Windows API (Win32)
*   **编译器**：MinGW (GCC) / MSVC
*   **字符集**：Unicode (Wide Character)，彻底解决中文显示乱码问题。

### 3.2 核心模块
*   **消息循环 (Message Loop)**：程序入口 `WinMain` 负责初始化窗口并维护标准的消息分发循环。
*   **数据持久化 (File I/O)**：
    *   新增 `LoadHighScore()` 和 `SaveHighScore()` 函数。
    *   使用标准 C 文件操作 (`fopen_s`, `fread`, `fwrite`) 将最高分以二进制形式存储在 `highscore.dat` 文件中。
*   **窗口过程 (WndProc)**：
    *   `WM_PAINT`：使用 GDI (Graphics Device Interface) 进行图形绘制。
        *   新增高亮红色字体显示 Combo 特效。
        *   新增深蓝色字体显示最高分记录。
    *   `WM_TIMER`：利用 `SetTimer` 创建周期性中断，更新字母垂直坐标 `y`。
    *   `WM_CHAR`：核心逻辑处理。
        *   **Combo逻辑**：判断击中增加 `iCombo`，失误重置 `iCombo = 0`。
        *   **回血逻辑**：`if (iCombo % 10 == 0)` 触发 `iFail--`。
        *   **暂停逻辑**：处理 `VK_ESCAPE` 键切换 `paused` 状态。
*   **图形渲染**：
    *   使用 `TextOutW` 绘制 Unicode 文本。
    *   使用 `CreateFontW` 创建自定义字体（粗体 Arial）。
    *   使用 `SetTextColor` 实现动态彩色文字（如连击时的红色高亮）。

## 4. 编译与构建

使用 g++ 编译器进行编译，需要链接 Windows 子系统库：

```bash
g++ main.cpp -o game.exe -mwindows
```

*   `-mwindows`：指定生成 Windows GUI 应用程序，运行时不显示控制台窗口，并自动链接 `gdi32` 和 `user32` 等必要库。

## 5. 项目结构
*   `main.cpp`：包含所有源代码，包括窗口注册、消息处理、游戏逻辑、绘图函数及文件读写函数。
*   `highscore.dat`：(自动生成) 存储最高分数据的二进制文件。
